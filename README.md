## Автоматизированная аналитическая отчетность в Telegram

**Задача:**

Создать автоматизированную ежедневную отправку аналитической сводки о работе приложения в Telegram. Отчет должен обеспечить заинтересованных лиц актуальной информацией по ключевым метрикам в удобном для просмотра формате.

**Функциональные требования:**

1.  **Метрики:**
    Отчет должен содержать следующие ключевые метрики, рассчитанные за предыдущий день:
    
    *   **DAU (Daily Active Users):**
        *   Количество уникальных пользователей, взаимодействовавших с **Лентой новостей** и с **Мессенджером**.
    *   **Лайки (Likes) и Просмотры (Views):**
        *   Общее количество лайков и просмотров контента в **Ленте новостей**.
    *   **CTR (Click-Through Rate):**
        *   Отношение лайков к просмотрам в **Ленте новостей**.
        * **Отправленные сообщения (Messages Sent)**:
           * Общее количество отправленных сообщений в **Мессенджере**.
        *  **Отправлено/Получено**:
           * Соотношение отправленных и полученных сообщений в **Мессенджере**.   

2.  **Отображение динамики метрик (7 days offset):**
    *   Для каждой из вышеуказанных метрик отчет должен включать графики, отображающие динамику метрик за последние 7 дней (с учетом предыдущего дня).
    *   Графики должны быть включены в отчет в виде изображений.
    *   Графики должны отображать отдельно метрики для Ленты и для Мессенджера.
    
3.  **Формат и содержание отчета:**
    *  Отчет должен отправляться как сообщение в телеграм, включая текст с значениями метрик и изображения графиков.
    *  Отчет должен предоставлять информацию об общей динамике приложения, а также о его отдельных частях (Ленте и Мессенджере).
    *  Отчет должен содержать ссылку на дашборд в Superset, для более детальной информации о метриках. 

4.  **Время отправки отчета:**
    *   Отчет должен отправляться ежедневно в 11:00 (утра) по местному времени.
    *   Отправка отчета должна быть полностью автоматизирована и не требовать ручного вмешательства.

**Описание решения:**

Для достижения поставленной цели необходимо реализовать следующий ETL-процесс и набор задач:

1.  **Подготовка Telegram-бота:**
    *   Создание Telegram-бота с использованием @BotFather.
    *   Получение `chat_id` для отправки сообщений в нужный чат или пользователю.

2.  **Сбор и агрегация данных:**
    *   Разработка скрипта для сбора данных о метриках приложения, вычисления метрик за предыдущий день и предшествующие 7 дней.

3.  **Формирование отчета:**
    *   Формирование текстового отчета со значениями ключевых метрик за предыдущий день.
    *   Создание набора графиков с динамикой метрик за последние 7 дней, объединение их на одном изображении с помощью 'subplots'. 
    *   Изображение с графиками сохранялось на в **формате PNG** для дальнейшей отправки.

4.  **Интеграция с Apache Airflow:**
    *   Реализация ETL-процесса с использованием Apache Airflow для автоматизации сбора данных, формирования отчета и его отправки.
    *   Разработка DAG (Directed Acyclic Graph), который будет запускать процесс по расписанию.

## Визуализация процесса в Airflow

Ниже представлен общий вид DAG в Apache Airflow:

![dag_project2](https://github.com/user-attachments/assets/519846e4-e8c5-4364-8d46-80a0f9914960)

## Код

Ознакомится с кодом можно в "dag_project_scheduled_reporting.py"

## Результат работы DAG: Отчет в Telegram

Ниже показан пример отчета, отправляемого в Telegram:

![dag_project2_2](https://github.com/user-attachments/assets/f613a9f3-4a90-4ffb-9372-f9d22b699567)

**Технологии:**

*   Python
*   Apache Airflow
*   Apache Superset
